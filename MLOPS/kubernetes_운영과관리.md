큰 노드를 적게 가져갈 경우 (장점)
- 관리의 편의성
- 장비에 대한 업데이트/트러블슈팅을 하게 될 확률이 낮다
- 총 예산이 싸다 (큰 장비 1개가 작은장비 10개보다 낫다)
- 큰 어플리케이션 실행할때 좋음
- (온프레미스경우이며,퍼블릭 클라우드 경우일경우 상관 X)

큰노드를 적게 가져갈 경우 (단점)
- 하나의 노드에 많은 pod가 실행되서 kubelet, container runtime에 부하가 걸림
- 쿠버네티스에서(커뮤니티 소시발에 의하면) 왠만하면 노드당 110개 pod를 권장한다고 서술되어있음
https://kubernetes.io/ko/docs/setup/best-practices/cluster-large/
여담 : EKS에서는 인스턴스 타입별로 4~737개 파드를 가질수 있음 (제한됨), GKE는 110개
- 장애 발생시 규모가 큼, 다른 노드에 큰 부하가 발생

작은 노드를 많이 가져갈 경우 (단점)
- HA 구성시 유리 (수평적 오토스케일링)
- 관리하는 노드가 많아서, 마스터 노드의 부하가 증가
- 노드당 기본적으로 사용되는 리소스가 존재(os,kubelet,도커데몬 등)


---------------------------------------------------------------
일반유저
- 쿠버네티스에서는 유저 정보를 저장하는 부분이 없다.
- 유저를 생성/관리하는 API가 없다 -> 올바른 인증서나 Token을 API서버에 전달하고, 유효성을 검증하여 인증

kube-apiserver (마스터 노드)
- 쿠버네티스 리소스를 제어할 수있는 API제공, 요청에 대한 인증 처리, 노드 혹은 pod에 접근할 수 있는 proxy 수행
  
----------------------------------------------------------------
인증 수단
- X.509 인증서를 활용한 TLS 인증
- http 인증을 활용한 사용자 인증 (토큰을 이용한 인증)
-> 큐브api에 옵션을 다음과 같이 추가해 줘야함
-> --token-auth-file = somefile 
- 인증 프록시를 활용한 대리 인증
- 웹훅을 통한 사용자 인증
- OIDC를 활용한 외부 인증 시스템과 연동

-----------------------------------------------------------------------
인가 모드

인증과 인가는 엄연히 다름, 유저는 인증했다고 해서 모든 자원을 접근,사용할 수는 없음
  - ABAC (attribute based access control) 속성 기반 접근 제어
  - 유저나 그룹별로 접근할 수 있는 속성을 하나의 파일로 관리
  - api그룹,네임스페이스,리소스 등
  - 쿠버네티스api 설정 변경 필요하고, policyfile을 통해 관리, 쿠버네티스 api 재시작 필요

  - RBAC (role based access control) 롤기반 접근제어
  - 롤과 롤바인딩을 쿠버네티스 API로 생성/관리
  - 롤바인딩 : 특정 유저와 그룹에 role 적용
  - api서버 모드 설정 필요, api서버 재시작 필요 없이 설정 가능
    
  - role이란?
  - 특정 리소스에 대해 수행 할 수있는 액션에 대한 룰의 집합
  - 특정 네임스페이스에 특정 롤이 정해져 있음

  rolebinding이란?
  - 특정 유저나 그룹에게 롤을 부여하는 리소스
  - subject : 롤을 부여할 유저, 그룹
  - roleref : 유저, 그룹에게 부여할 룰
  - clusterRole, clusterrolbinding도 존재

----------------------------------------------------------------------------
리소스 제한
컨테이너, pod에 자원 제한을 걸어둠

pod상태가 pending이다?
-> 전체 노드가 pod의 요청자원을 수용할만한 자원이 없는지 확인

pod가 갑자기 restart됨
-> pod의 컨테이너 메모리 사용량이 limits를 초과하는지 확인

쿠버네티스 정책적으로 네임스페이스별로 리소스를 제한 할 수 있다
-> kind : resourcequota

----------------------------------------------------------------------------
kubeadm
쿠버네티스 클러스터의 부트스트랩 도구 -> 오로지... 쿠버네티스 노드에 대해서만 관여
CNI, CSI (클러스터 네트워크,스토리지 인터페이스 -> 네트워크 및 스토리지 관리) 등 쿠버네티스를 사용할때 필요한 컴포넌트는 지원 안함

kubeadm init
- 마스터 노드에 쿠버네티스 컴포넌트를 실행할 수 있는지 사전 체크
- 쿠버네티스 컴포넌트가 사용할 인증서 생성
- 컨피그 생성, ETCD 설치
- 멀티 마스터 지원 및 로드밸런서 지원

---------------------------------------------------
kubespray 큐브 스프레이

- 쿠버네티스 클러스터 구축을 위한 앤서블 플레이북
- 클러스터 구축시 필요한 다양한 옵션 제공
- 다양한 리눅스 배포판 지원
- 클러스터 업그레이드, HA(수평적 오토스케일링) 구성, 노드 추가 / 삭제, 대규모 클러스터 구성 등
- 다수의 노드를 설치/관리할 때 유용
---------------------------------------------------
cluster-api
쿠버네티스 안에 쿠버네티스를 쓸수있는거임
쿠버네티스 리소스로서 쿠버네티스 관리
인프라 프로바이더 컨트롤러 제공

-----------------------------------------------------
# 쿠버네티스 구성요소

컨트롤 플레인은 3가지로 구성
큐브 api서버 -> 외부로부터 요청으로부터 리소스를 제어할 수 있는 기능을 제공
큐브 스케줄러 -> 노드들의 상태를 파악하고 요청받은 리소스가 실행될 수 있는 곳에 리소스를 배치함
desired state를 유지하려고 노력함
ETCD -> 상태저장소

ccm => 클라우드 컨트롤 매니져
-> 퍼블릭 클라우드의 제어를 하기 위해사용

워커노드는
kubelet -> 노드의 내부 저장소
kubeproxy -> 노드의 프록시로, 노드의 네트워크 규칙,생성을 관리

----------------------------------------------------------------------
쿠버네티스 서비스의 DNS를 제공하는 coredns


























