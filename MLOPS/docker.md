1강 도커 이미지와 컨테이너
도커엔진(호스트)가 이미지를 기반으로 컨테이너를 생성-> 네트워크, 자원의 격리로 운영됨

도커 이미지와 컨테이너

도커 이미지 이름 구성
-> 저장소이름/이미지이름:이미지태그

---------------------------------------------
2강 도커 컨테이너 다루기 컨테이너 라이프 사이클

도커 주요 옵션
-i # 호스트의 표준 입력을 컨테이너와 연결
-t # TTY 할당
--rm # 컨테이너 실행 종료후 자동 삭제
-d  # 벡그라운드로 실행
--name hello  # 컨테이너 이름 지정
-p #호스트:컨테이너간 포트 바인딩
-v #호스트:컨테이너간 볼륨 바인딩

docker container prune # 중지된 모든 컨테이너 삭제

---------------------------------------------
3강 도커를 이용한 컨테이너 관리
엔트리 포인트와 커맨드

엔트리 포인트
-> 도커 컨테이너가 실행할 때 고정적으로 실행되는 스크립트 혹은 명령어, 생략할 수 있으며, 생략된 경우 커맨드에 지정된 명령어로 수행

커맨드
-> 도커 컨테이너가 실행 할 때 수행할 명령어 혹은 엔트리포인트에 지정된 명령어에 대한 인자값

docker run --entrypoint sh ubuntu:focal
docker run --entrypoint echo ubuntu:focal hellow-world

---------------------------------------------
4강
도커의 환경변수 다루기
docker run -it -e MY_HOST=fastcampus.com ubuntu:focal bash

환경변수 파일로 주입
docker run -it --env-file ./env.txt ubuntu:focal

env.txt 내용은
MY_HOST = 10.23.1.3
TEMP = toto
등

왜 환경변수를 하냐?
-> 도커 개발,테스트시 환경변수를 이용하는 컨테이너 제어

------------------------------------------
5강
exec # 실행중인 컨테이너에 명령어를 실행

-------------------------------------------
6강
도커 네트워크

expose 옵션은 그저 문서화 용도
-p 와 비슷함

도커 네트워크 드라이버
docker network ls
종류
브릿지,호스트,None,overlay
----------------------------------------------
7강
도커 볼륨

 
특정 컨테이너의 볼륨을 마운트 할 수도 있음 -> 볼륨 컨테이너를 따로 만듬
docker run --volumes-from 컨테이너이름


도커 볼륨도 따로 생성 할 수 있음
docker volume create --name db


읽기전용 볼륨 연결도 있음 -> read only
docker run -v data:/data:ro

-----------------------------
8강
로그 다루기

로그확인
docker logs 컨테이너네임

마지막 로그 확인
docker logs --tail 10 컨테이너 네임


로그 용량 제한하기
docker run -d --log-driver=json-file --log-opt max-size=-3m --log-opt max-file=5

도커 로그 드라이버
json,AWS 클라우드 와치, 등으로 보낼수 있음

----------------------------------
9강
이미지 빌드

이미지 빌드방법은 2가지
1. dockerfile로 생성
2. dockerfile없이 생성 -> commit으로 생성하는것

생성 명령어
docker build -t my_app:v1 -f example/mydockerfile .
t는 태그
f는 빌드할 파일


빌드 컨텍스트
도커 빌드 명령 수행시 현재 디텍터리를 빌드 컨텍스트라고 함.
dockerfile로부터 이미지빌드에 필요한 정보를 도커 데몬에게 전달하기 위함
-> 현재 디렉터리의 모든파일을 참조하기 때문에 빌드시간이 오래걸림
-> 그래서 .dockerignore파일을 만들어서 빌드컨텍스트에서 제외할 파일 or 폴더를 선정해 빌드 타임을 줄임

-------------------------------------
10강
docker file 문법

주석 -> #

FROM -> 베이스 레이어

ENV 환경변수
-> ENV FOO=/bar (변수 foo에 bar라는 스트링이 들어감)

ARG -> 빌드할때 아규먼트로 넘길수도 있음

LABEL -> 이미지의 메타데이터 지정 (거의 필요없음)

WORKDIR -> 작업폴더 지정

COPY -> 파일 복사

RUN -> 해당 명령어 실행

EXPOSE 8080  -> 8080포트를 사용한다는 문서론적인 의미임, 퍼블리싱 하는것이 아님 (열리지않음)

CMD -> 컨테이너를 실행할때 어떤 명령어를 실행 할 것인가를 설정


ENTRYPOINT
엔트리포인트와 CMD의 차이는?
-> CMD랑 비슷 -> 나중에 정리하자

USER
-> 도커 컨테이너가 사용할 기본 유저

----------------------------
11강 
이미지 압축파일로 저장하기

docker save -o data.tar 이미지네임

docker load -i data.tar

------------------------------------------
12강
이미지 저장소 docker hub
-----------------------------------------
13강
이미지 저장소 ECR
------------------------------------------
14강
이미지 경량화 전략
왜 필요한가?
-> 풀 푸쉬,컨테이너 실행 속도, 해당 호스트에서 보유할수 있는 컨테이너 갯수 증가 등

1. 꼭 필요한 패키지 및 파일만 추가
2. 컨테이너 레이어수줄이기 (dockerfile의 RUN 지시어 수에 따라 레이어가 쌓임)
3. 경량 베이스 이미지 선택 (데이안의 slim, alpine)
4. 멀티 스테이지 빌드 (FROM에서 as를 이용해서 임시 이미지(블록)으로 만듬)

빌드할때 패키지를 다 지우자
예시) RUN apk add --no-cache bash curl git && apk del --nocache git

-------------------------------------------
15강
데몬 디버깅

해당 도커 시스템 정보 출력
docker system info

도커 이벤트들을 볼 수 있음
docker system events

이미지, 컨테이너의 디스크 사용령
docker df
docker df -v

사용하지 않는 네트워크, 컨테이너, 빌드 캐시등 싹다 지움
docker system prune

도커 자원 사용량 확인
docker stats

-----------------------------------------
16강
도커 컴포즈

여러 컨테이너를 묶어서 관리하기 위함
명시적 관리


----------------------------------------
docker 활용
1강
----------------------------------
2강
Nexus 아티팩트 repository -> 스프링 부트, 라이브러리 저장소
sonarqube -> 개발 코드 분석 솔루션 (코드 스캔)
clair -> 컨테이너 이미지의 취약점 분석툴

----------------------------------
3강
도커 빌드를 위한 젠킨스 활용 소개


-------------------------
빌드란 무었인가?
컴퓨터 소프트웨어 분야에서 소프트웨어 빌드는, 소스코드파일을 컴퓨터나 휴대폰에서 실행할 수 있는 독립(standalone) 소프트웨어 아티팩트로 변환하는 과정,결과물을 일컫는다.
소프트웨어 빌드에 있어 가장 중요한 단계중 하나는 소스코드 파일이 실행코드로 변환되는 '컴파일' 과정이다.
보통 빌드 도구에 의해 빌드과정이 관리된다.




























